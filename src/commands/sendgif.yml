description: >
  Sends an animated image to the specified Telegram chat.

parameters:
  gif-url:
    description: Enter the animated image's URL.
    type: string
    default: ""

  telegram-bot-token:
    type: env_var_name
    default: TELEGRAM_BOT_TOKEN
    description: >
      Name of environment variable storing your Telegram bot token

  telegram-chat-id:
    type: env_var_name
    default: TELEGRAM_CHAT_ID
    description: >
      Name of environment variable storing your Telegram chat id

steps:
  - run:
      name: Send an annimated image
      shell: /bin/bash
      command: |
        if [ ! "$<<parameters.gif-url>>" == "" ]; then
          STATUS=$(curl -I  "https://api.telegram.org/bot$<<parameters.telegram-bot-token>>/sendAnimation?chat_id=$<<parameters.telegram-chat-id>>&animation=<<parameters.gif-url>>" 2>/dev/null | head -n 1 | cut -d$' ' -f2)
          if [ $STATUS -ge "400" ]; then
            echo "Sending GIF failed with HTTP response code $STATUS"
          fi
        else
          echo GIF URL invalid;
        fi
